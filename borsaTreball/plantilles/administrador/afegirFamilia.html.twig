{% extends "auxiliars/baseDins.html.twig" %}

{% block head %}
    <title>Borsa de treball: Alta de families professionals</title>

    <script>


        $(document).ready(function () {
            let dades={};

            $('#mdResultat').modal({backdrop: 'static', keyboard: false, show: false});
            $('#bmDacord').on('click', function () {
                $('#mdResultat').modal('hide');
            });
            $('#mdEspera').modal({backdrop: 'static', keyboard: false, show: false});
            $('#mEsperaTitol').html('Realitzant les modificacions');
            $('#mdEspera').on('shown.bs.modal', function (e) {
                    $.ajax({
                        method: 'POST',
                        url: "afegirFamilia",
                        data: dades
                    }).done(function () {
                        $('#mrTitol').html('Inserció correcte')
                        $('#mrText').html("<p>S'ha afegit correctament la nova família professional.</p>");
                        $('#bmDacord').on('click', function () {
                            window.location.href = "afegirFamilia";
                        });
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        $('#mrTitol').html('<span class="glyphicon glyphicon-alert"></span>&nbsp; Problemes amb l\'actualització');
                        $('#mrText').html("<p>" + (typeof jqXHR.responseJSON === 'undefined' ? errorThrown : jqXHR.responseJSON.missatge) + "</p>");
                        $('#bmDacord').on('click', function () {
                            $('#mdResultat').modal('hide');
                        });
                    }).always(function () {
                        $('#mdEspera').modal('hide');
                        $('#mdResultat').modal('show');
                    });
            });


            $("#fFamilia").on('submit', function (event) {
                event.preventDefault();
                dades.id= document.getElementById("id").value.trim().toUpperCase();
                dades.nom = document.getElementById("nom").value.trim();
                $('#mdEspera').modal('show');
            });


        });
    </script>
    <script src="../js/dirtyForms.js"></script>

{% endblock %}

{% block navegacio %}
    {% set actiu=154 %}
    {{ parent() }}
{% endblock %}                     

{% block contingut %}
    <h2>Alta de families professionals</h2>
    <div class="well">
        <form id="fFamilia">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group required">
                        <label class='control-label' for="id">Codi:</label>
                        <input type="text" required="required" class="form-control " id="id" name="id" autocapitalize="characters">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group required">
                        <label class='control-label' for="nom">Nom:</label>
                        <input type="text" required="required" class="form-control " id="nom" name="nom">
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class="col-md-12">
                    <div class="form-group">
                        <button id="bSubmit" type="submit" class="btn btn-success">D'acord</button>
                        <button id="bReset" class="btn btn-default" type="reset">Cancel·lar</button>
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class="col-md-12">
                    <p>Tots els camps són obligatoris</p>
                </div>
            </div>
        </form>
    </div>

    {{ include('auxiliars/modals.html.twig') }}
{% endblock %}  