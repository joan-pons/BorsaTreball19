{% extends "auxiliars/baseDins.html.twig" %}

{% block head %}
    <title>Borsa de treball: Llista d'estudis</title>

    <script>
        function createButton(tipus, classe, text, click) {
            const boto = document.createElement("button");
            boto.type = tipus;
            boto.className = classe;
            boto.appendChild(document.createTextNode(text));
            boto.addEventListener("click", click);
            return boto;
        }

        $(document).ready(function () {
            var dades = {};

            $('#mdResultat').modal({backdrop: 'static', keyboard: false, show: false});
            $('#bmDacord').on('click', function () {
                $('#mdResultat').modal('hide');
            });
            $('#mdEspera').modal({backdrop: 'static', keyboard: false, show: false});
            $('#mEsperaTitol').html('Realitzant les modificacions');
            $('#mdEspera').on('shown.bs.modal', function (e) {
                $.ajax({
                    method: 'DELETE',
                    url: "families/" + dades.id
                }).done(function () {
                    $('#mrTitol').html('Eliminació correcte')
                    $('#mrText').html("<p>S'ha eliminat correctament la família professional.</p>");
                    $('#bmDacord').on('click', function () {
                        $('#mdResultat').modal('hide');
                        location.reload();
                    });
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    $('#mrTitol').html('<span class="glyphicon glyphicon-alert"></span>&nbsp; Problemes amb l\'eliminació');
                    $('#mrText').html("<p>" + (typeof jqXHR.responseJSON === 'undefined' ? errorThrown : jqXHR.responseJSON.missatge) + "</p>");
                    $('#bmDacord').on('click', function () {
                        $('#mdResultat').modal('hide');
                    });
                }).always(function () {
                    $('#mdEspera').modal('hide');
                    $('#mdResultat').modal('show');
                });
            });

            $("#mcTitol").html("Esborrar estudis");
            $("#bcCancelar").on("click", () => {
                $("#mdConfirm").modal("hide");
            })

            $("#bcDacord").on("click", () => {
                $("#mdConfirm").modal("hide");
                $("#mdEspera").modal("show");
            })

            let familiesProfessionals = [];
            {% for familia in families %}
            familiesProfessionals.push({id:"{{ familia.id }}", nom: "{{ familia.nom }}"});
            {% endfor %}


            const mostrador = document.getElementById("mostrador");
            while (mostrador.lastChild) {
                mostrador.lastChild.remove();
            }
            familiesProfessionals.forEach(familia => {
                const div = document.createElement("div");
                div.classList.add("well");
                const p = document.createElement("p");
                p.appendChild(document.createTextNode(familia.id + " - " + familia.nom));
                div.appendChild(p);

                const bModifica = createButton("button", "btn btn-primary", "Modificar", () => {
                    document.location = "modificarFamilia?idFamilia=" + familia.id;
                });
                const bEsborra = createButton("button", "btn btn-danger", "Esborra", () => {
                    dades.id = familia.id;
                    $("#mcText").html(`<p>S'eliminarà de l'aplicació la familia professional:</p><h5>${familia.id} - ${familia.nom}</h5><p>Sempre que no tengui dades associades.</p>`);
                    $("#mdConfirm").modal("show");
                });
                p.appendChild(document.createTextNode(" "));
                p.appendChild(bModifica);
                p.appendChild(document.createTextNode(" "));
                p.appendChild(bEsborra);
                mostrador.appendChild(div);
            });

        })
            ;
    </script>
    <script src="../js/dirtyForms.js"></script>

{% endblock %}

{% block navegacio %}
    {% set actiu=153 %}
    {{ parent() }}
{% endblock %}                     

{% block contingut %}
    <h1>Llista de famílies professionals</h1>
    <div class="well" id="mostrador">

    </div>
    {{ include('auxiliars/modals.html.twig') }}
{% endblock %}  