{% extends "auxiliars/baseDins.html.twig" %}

{% block head %}
    <title>Borsa de treball: Llistade tipus d'estudis</title>

    <script>
        function createButton(tipus, classe, text, click) {
            const boto = document.createElement("button");
            boto.type = tipus;
            boto.className = classe;
            boto.appendChild(document.createTextNode(text));
            boto.addEventListener("click", click);
            return boto;
        }

        $(document).ready(function () {
            var dades = {};

            $('#mdResultat').modal({backdrop: 'static', keyboard: false, show: false});
            $('#bmDacord').on('click', function () {
                $('#mdResultat').modal('hide');
            });
            $('#mdEspera').modal({backdrop: 'static', keyboard: false, show: false});
            $('#mEsperaTitol').html('Realitzant l\'eliminació');
            $('#mdEspera').on('shown.bs.modal', function (e) {
                $.ajax({
                    method: 'DELETE',
                    url: "tipusEstudis/" + dades.id
                }).done(function () {
                    $('#mrTitol').html('Eliminació correcte')
                    $('#mrText').html("<p>S'ha eliminat correctament el tipus d'estudis.</p>");
                    $('#bmDacord').on('click', function () {
                        $('#mdResultat').modal('hide');
                        location.reload();
                    });
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    $('#mrTitol').html('<span class="glyphicon glyphicon-alert"></span>&nbsp; Problemes amb l\'eliminació');
                    $('#mrText').html("<p>" + (typeof jqXHR.responseJSON === 'undefined' ? errorThrown : jqXHR.responseJSON.missatge) + "</p>");
                    $('#bmDacord').on('click', function () {
                        $('#mdResultat').modal('hide');
                    });
                }).always(function () {
                    $('#mdEspera').modal('hide');
                    $('#mdResultat').modal('show');
                });
            });

            $("#mcTitol").html("Esborrar tipus d'estudis");
            $("#bcCancelar").on("click", () => {
                $("#mdConfirm").modal("hide");
            })

            $("#bcDacord").on("click", () => {
                $("#mdConfirm").modal("hide");
                $("#mdEspera").modal("show");
            })

            let tipusEstudis = [];
            {% for tipus in llistaTipus %}
                tipusEstudis.push({id: "{{ tipus.idTipus }}", nom: "{{ tipus.nomTipus }}"});
            {% endfor %}


            const mostrador = document.getElementById("mostrador");
            while (mostrador.lastChild) {
                mostrador.lastChild.remove();
            }
            tipusEstudis.forEach(tipus => {
                const div = document.createElement("div");
                div.classList.add("well");
                const p = document.createElement("p");
                p.appendChild(document.createTextNode(tipus.id + " - " + tipus.nom));
                div.appendChild(p);

                const bModifica = createButton("button", "btn btn-primary", "Modificar", () => {
                    document.location = "modificarTipusEstudis?idTipus=" + tipus.id;
                });
                const bEsborra = createButton("button", "btn btn-danger", "Esborra", () => {
                    dades.id = tipus.id;
                    $("#mcText").html(`<p>S'eliminarà de l'aplicació el tipus d'estudis:</p><h5>${tipus.id} - ${tipus.nom}</h5><p>Sempre que no tengui dades associades.</p>`);
                    $("#mdConfirm").modal("show");
                });
                p.appendChild(document.createTextNode(" "));
                p.appendChild(bModifica);
                p.appendChild(document.createTextNode(" "));
                p.appendChild(bEsborra);
                mostrador.appendChild(div);
            });

        })
        ;
    </script>
    <script src="../js/dirtyForms.js"></script>

{% endblock %}

{% block navegacio %}
    {% set actiu=155 %}
    {{ parent() }}
{% endblock %}                     

{% block contingut %}
    <h1>Llista de tipus d'estudis</h1>
    <div class="well" id="mostrador">

    </div>
    {{ include('auxiliars/modals.html.twig') }}
{% endblock %}  